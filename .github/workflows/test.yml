name: Build and run Tests

on:
    push:
        branches: ["main"]
    pull_request:
        branches: ["main"]
    workflow_dispatch:

jobs:
    build:
        strategy:
            matrix:
                version: [20, 21, 22]
                os: [ubuntu-latest, windows-latest, macos-latest]
        runs-on: ${{ matrix.os }}
        steps:
            - uses: actions/checkout@v5
            - uses: actions/setup-node@v5
              with:
                  node-version: ${{ matrix.version }}
            - name: Install Dependencies
              run: npm install
            - name: Build
              run: npm run build
            - name: Test
              run: npm run test
            - name: Call Cli
              run: npm run call -- -n ${{ secrets.GREET_NAME }}
            - name: Install and Run Cli
              run: |
                  npm install -g
                  gscrap -n ${{ secrets.GREET_NAME }}
